# 🚀 배포 가이드 (GitHub → Vercel)

## 📋 체크리스트

배포하기 전에 다음 항목들을 확인하세요:

- [ ] Supabase 프로젝트 설정 완료
- [ ] 제품 데이터 초기화 완료 (관리자 패널)
- [ ] Storage 버킷 `sinsuru` 생성 완료
- [ ] 제품 이미지 업로드 완료 (선택사항)
- [ ] GitHub 계정 준비
- [ ] Vercel 계정 준비

---

## 🔐 1단계: 환경 변수 보안 강화

현재 `/utils/supabase/info.tsx`에 키가 하드코딩되어 있습니다. 배포 전 환경 변수로 변경하는 것을 **강력히 권장**합니다.

### 옵션 A: 환경 변수로 변경 (권장)

`/utils/supabase/info.tsx` 파일을 다음과 같이 수정:

```typescript
/* AUTOGENERATED FILE - DO NOT EDIT CONTENTS */

export const projectId = import.meta.env.VITE_SUPABASE_PROJECT_ID || "ucoghecfsnphdguexbiv";
export const publicAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY || "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVjb2doZWNmc25waGRndWV4Yml2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY4NjI2NDQsImV4cCI6MjA3MjQzODY0NH0.sSCxnOQvmAxROvvAKf3AP9pJTPtVQQ48YDFweXwjslI";
```

### 옵션 B: 그대로 배포 (빠른 테스트용)

테스트 목적이라면 현재 상태 그대로 배포 가능합니다. 하지만 프로덕션 환경에서는 권장하지 않습니다.

---

## 📂 2단계: GitHub 저장소 생성 및 푸시

### 2-1. GitHub에서 새 저장소 생성

1. https://github.com 접속 및 로그인
2. 우측 상단 "+" 클릭 → "New repository"
3. 저장소 정보 입력:
   - **Repository name**: `sinsuru-ecommerce` (원하는 이름)
   - **Description**: "Sinsuru e-commerce website"
   - **Visibility**: Public 또는 Private
   - ❌ **Initialize this repository with**: 모두 체크 해제
4. "Create repository" 클릭

### 2-2. 로컬에서 Git 초기화 및 푸시

터미널에서 프로젝트 폴더로 이동 후 실행:

```bash
# Git 초기화 (아직 안 했다면)
git init

# 모든 파일 스테이징
git add .

# 첫 커밋
git commit -m "Initial commit: Sinsuru e-commerce website"

# 기본 브랜치를 main으로 설정
git branch -M main

# GitHub 저장소 연결
# 저장소 URL은 GitHub에서 생성한 저장소 페이지에서 확인
git remote add origin https://github.com/YOUR_USERNAME/sinsuru-ecommerce.git

# 푸시
git push -u origin main
```

> **주의**: `YOUR_USERNAME`을 본인의 GitHub 사용자명으로 변경하세요!

### 2-3. 푸시 확인

GitHub 저장소 페이지를 새로고침하여 파일이 업로드되었는지 확인하세요.

**✅ 확인 사항**:
- `package.json`, `vite.config.ts`, `tsconfig.json` 파일이 있는지 확인
- `.gitignore`가 제대로 작동하여 `node_modules` 폴더가 제외되었는지 확인
- `.env` 파일이 제외되었는지 확인 (보안)

---

## 🌐 3단계: Vercel 배포

### 3-1. Vercel 프로젝트 생성

1. https://vercel.com 접속 및 로그인
   - GitHub 계정으로 로그인 권장
2. "Add New..." → "Project" 클릭
3. GitHub 저장소 연결:
   - "Import Git Repository" 섹션에서 방금 생성한 저장소 찾기
   - "Import" 클릭

### 3-2. 프로젝트 설정

**Configure Project** 페이지에서:

1. **Framework Preset**: Vite (자동 감지됨)
2. **Root Directory**: `.` (기본값)
3. **Build Command**: `npm run build` (기본값)
4. **Output Directory**: `dist` (기본값)

### 3-3. 환경 변수 설정

**Environment Variables** 섹션에서 다음 변수들을 추가:

| Name | Value |
|------|-------|
| `SUPABASE_URL` | `https://ucoghecfsnphdguexbiv.supabase.co` |
| `SUPABASE_ANON_KEY` | `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVjb2doZWNmc25waGRndWV4Yml2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY4NjI2NDQsImV4cCI6MjA3MjQzODY0NH0.sSCxnOQvmAxROvvAKf3AP9pJTPtVQQ48YDFweXwjslI` |
| `SUPABASE_SERVICE_ROLE_KEY` | (Supabase 대시보드에서 확인) |
| `SUPABASE_DB_URL` | (Supabase 대시보드에서 확인) |

#### 환경 변수 찾는 방법:

1. https://supabase.com/dashboard 접속
2. 프로젝트 선택
3. 좌측 메뉴 "Settings" → "API"
4. **URL**: `SUPABASE_URL`
5. **anon public**: `SUPABASE_ANON_KEY`
6. **service_role**: `SUPABASE_SERVICE_ROLE_KEY`
7. 좌측 메뉴 "Settings" → "Database" → **Connection string** → **URI**: `SUPABASE_DB_URL`

**옵션 A를 선택했다면** 추가로:

| Name | Value |
|------|-------|
| `VITE_SUPABASE_PROJECT_ID` | `ucoghecfsnphdguexbiv` |
| `VITE_SUPABASE_ANON_KEY` | (위와 동일) |

### 3-4. 배포 시작

1. 모든 설정 확인
2. **"Deploy"** 버튼 클릭
3. 배포 진행 상황 확인 (약 1-2분 소요)

### 3-5. 배포 완료

배포가 완료되면:
- ✅ 성공 메시지 표시
- 🌐 배포 URL 확인 (예: `https://sinsuru-ecommerce.vercel.app`)
- 🎉 "Visit" 버튼 클릭하여 사이트 확인

---

## 🔧 4단계: Supabase Edge Functions 배포

Supabase Edge Functions은 별도로 배포해야 합니다.

### 4-1. Supabase CLI 설치

```bash
npm install -g supabase
```

### 4-2. Supabase 로그인

```bash
supabase login
```

브라우저가 열리면 로그인하고 액세스 토큰을 터미널에 붙여넣기

### 4-3. 프로젝트 연결

```bash
supabase link --project-ref ucoghecfsnphdguexbiv
```

비밀번호 입력 (Supabase 데이터베이스 비밀번호)

### 4-4. Edge Functions 배포

```bash
supabase functions deploy make-server-cb50e858
```

### 4-5. 환경 변수 설정 (Edge Functions용)

```bash
supabase secrets set SUPABASE_URL=https://ucoghecfsnphdguexbiv.supabase.co
supabase secrets set SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
```

---

## ✅ 5단계: 배포 확인 및 테스트

### 5-1. 사이트 접속

Vercel 배포 URL로 접속 (예: `https://sinsuru-ecommerce.vercel.app`)

### 5-2. 기능 테스트

1. **홈 페이지**: 로고 및 메인 디자인 확인
2. **SHOP → BODY → SOAP**: 카테고리 페이지로 이동
3. **제품 목록**: 8개 제품이 표시되는지 확인
4. **제품 클릭**: 상세 페이지로 이동하는지 확인
5. **롤링 이미지**: 상세 페이지에서 이미지 전환 확인

### 5-3. 관리자 패널 테스트

1. 우측 하단 관리자 패널 열기
2. "1. 제품 데이터 초기화" 버튼 클릭
3. 성공 메시지 확인
4. 페이지 새로고침 후 제품 목록 확인

### 5-4. 브라우저 콘솔 확인

F12를 눌러 콘솔을 열고 에러가 없는지 확인:
- ✅ 이미지 로드 에러는 정상 (아직 이미지 업로드 안 했으면)
- ❌ API 에러나 서버 에러가 있으면 해결 필요

---

## 🐛 문제 해결

### 배포는 성공했지만 페이지가 비어있어요

**원인**: 환경 변수가 제대로 설정되지 않았을 수 있습니다.

**해결**:
1. Vercel 대시보드 → 프로젝트 → "Settings" → "Environment Variables"
2. 모든 환경 변수가 올바른지 확인
3. 변경 후 "Deployments" → 최신 배포 → "Redeploy" 클릭

### API 에러: 404 Not Found

**원인**: Edge Functions이 배포되지 않았거나 경로가 잘못되었습니다.

**해결**:
1. Supabase Functions 배포 재시도:
   ```bash
   supabase functions deploy make-server-cb50e858
   ```
2. Supabase 대시보드에서 Functions 탭 확인

### CORS 에러

**원인**: Supabase Edge Function의 CORS 설정 문제

**해결**:
`/supabase/functions/server/index.tsx`에서 CORS 설정 확인:
```typescript
app.use('*', cors({ origin: '*' }))
```

### 이미지가 안 보여요

**원인**: Supabase Storage에 이미지가 업로드되지 않았거나 경로가 잘못되었습니다.

**해결**:
1. 이미지가 없어도 fallback 이미지가 표시되므로 정상입니다
2. 이미지 업로드는 [`UPLOAD_GUIDE.md`](./UPLOAD_GUIDE.md) 참조

---

## 🔄 업데이트 및 재배포

### 코드 변경 후 재배포

```bash
# ��경사항 커밋
git add .
git commit -m "Update: 변경 내용 설명"

# GitHub에 푸시
git push origin main
```

Vercel은 자동으로 감지하여 재배포합니다! (약 1-2분 소요)

### Edge Functions 재배포

```bash
supabase functions deploy make-server-cb50e858
```

---

## 📊 배포 후 모니터링

### Vercel Analytics

1. Vercel 대시보드 → 프로젝트 → "Analytics"
2. 방문자 수, 성능 등 확인

### Supabase Logs

1. Supabase 대시보드 → "Logs"
2. Edge Functions 로그, Storage 로그 등 확인

---

## 🎉 완료!

축하합니다! 프로젝트가 성공적으로 배포되었습니다.

**배포 URL**: `https://your-project.vercel.app`

다음 단계:
- [ ] 커스텀 도메인 연결 (선택사항)
- [ ] 제품 이미지 업로드
- [ ] 실제 제품 데이터로 교체
- [ ] 결제 시스템 연동 (추후)

---

## 📞 지원

문제가 발생하면:
1. Vercel 배포 로그 확인
2. Supabase Edge Functions 로그 확인
3. 브라우저 콘솔 에러 확인
4. GitHub Issues에 문제 보고